# Oracle AutoUpgrade Utilities

This repository provides a structured and scriptable environment for working with
Oracle's **AutoUpgrade** tool across a variety of real-world use cases.

It includes ready-to-use scripts, configuration files, and documentation to support
scenarios such as:

- Patch downloading and management
- Critical Patch Updates (CPUs) and Release Updates (RUs)
- Secure keystore setup for My Oracle Support (MOS)
- Pre-checks, upgrade analysis, and upgrade execution
- Migrations (e.g. single-tenant to multitenant)
- Automation and consistent project layout

## üìÅ Project Structure

| Folder         | Description                                                  |
|----------------|--------------------------------------------------------------|
| `artefacts/`   | Output artifacts like PDFs, reports, exports                 |
| `bin/`         | Wrapper scripts (e.g. update, run AutoUpgrade, PDF export)   |
| `doc/`         | Markdown documentation and templates                         |
| `etc/`         | AutoUpgrade config files for various use cases              |
| `fonts/`       | Fonts for PDF styling                                        |
| `images/`      | Logos, diagrams, and screenshots                             |
| `jar/`         | Location of `autoupgrade.jar` and backups                    |
| `keystore/`    | Secure MOS credential wallet (excluded from Git)            |
| `logs/`        | Logs generated by AutoUpgrade (patching, analysis, etc.)     |
| `patches/`     | Oracle patches downloaded via AutoUpgrade                   |

## ‚úÖ Installation

You can install this project in two ways, depending on your server access.

### Option 1: Install Using Git (Online)

1. Clone the GitHub repository:

   ```bash
   cd /u00/app/oracle
   git clone https://github.com/oehrlis/autoupgrade.git
   cd autoupgrade
   ```

2. Download the latest AutoUpgrade JAR:

   ```bash
   ./bin/update_autoupgrade.sh
   ```

3. (Optional) Add scripts to your `PATH`:

   ```bash
   echo 'export PATH=/u00/app/oracle/autoupgrade/bin:$PATH' >> ~/.bash_profile
   source ~/.bash_profile
   ```

### Option 2: Install Using ZIP Download (Offline)

1. On a workstation with internet access, download the project ZIP:

   ```bash
   curl -LO https://github.com/oehrlis/autoupgrade/archive/refs/heads/main.zip
   ```

2. Transfer the ZIP to the database server and unpack:

   ```bash
   unzip main.zip
   mv autoupgrade-main /u00/app/oracle/autoupgrade
   cd /u00/app/oracle/autoupgrade
   ```

3. On a system with internet access, download the AutoUpgrade JAR:

   ```bash
   curl -Lf https://download.oracle.com/otn-pub/otn_software/autoupgrade.jar \
        -o autoupgrade.jar
   ```

4. Transfer the JAR to the server and place it in the correct folder:

   ```bash
   mv autoupgrade.jar /u00/app/oracle/autoupgrade/jar/
   ```

5. (Optional) Add scripts to your `PATH`:

   ```bash
   echo 'export PATH=/u00/app/oracle/autoupgrade/bin:$PATH' >> ~/.bash_profile
   source ~/.bash_profile
   ```

## üèÉ Running AutoUpgrade

Use the wrapper script to run AutoUpgrade with your chosen config file:

```bash
./bin/run_autoupgrade.sh -config etc/download_patch.cfg -mode download
```

This script:

- Automatically resolves `AUTOUPGRADE_BASE`
- Accepts both absolute and relative config paths
- Expands environment variables in the config via `envsubst`

## üîê Keystore for My Oracle Support (MOS)

If you use AutoUpgrade to download patches, you'll need a secure keystore
to store your MOS credentials.

Create the keystore using:

```bash
java -jar jar/autoupgrade.jar -config etc/download_patch.cfg -patch -load_password
```

See [`keystore/README.md`](keystore/README.md) for a full example session and security notes.

## üõ† Configuration Files

Configuration files are located in the `etc/` folder. They often use environment
variables like `$AUTOUPGRADE_BASE`, which are resolved automatically by
`run_autoupgrade.sh`.

Examples:

- `download_patch.cfg`: Downloads 19c patches for Linux x86\_64 and ARM

See [`etc/README.md`](etc/README.md) for usage examples and environment variable options.

## üìÑ Documentation

You can generate PDF documentation from Markdown files:

```bash
./bin/generate_pdf.sh doc/template.md
```

Output is stored in `artefacts/`, using fonts from the `fonts/` directory.

## üîÑ Keeping AutoUpgrade and This Project Up to Date

This project is composed of two parts:

### 1. Update the Project Code (Scripts, Configs, Docs)

#### Online Update via Git

If installed via Git:

```bash
cd /u00/app/oracle/autoupgrade
git pull origin main
```

#### Offline Update via ZIP

1. On a system with internet access:

   ```bash
   curl -LO https://github.com/oehrlis/autoupgrade/archive/refs/heads/main.zip
   ```

2. Transfer the ZIP to the server and replace the existing folder:

   ```bash
   unzip -o main.zip
   rm -rf /u00/app/oracle/autoupgrade
   mv autoupgrade-main /u00/app/oracle/autoupgrade
   ```

### 2. Update the AutoUpgrade Tool (`autoupgrade.jar`)

To download and replace `autoupgrade.jar`:

```bash
./bin/update_autoupgrade.sh
```

This script will:

- Download the latest JAR into `jar/`
- Back up the existing JAR with version or timestamp if changed

To update manually on an offline server:

1. Download `autoupgrade.jar` on a system with internet:

   ```bash
   curl -Lf https://download.oracle.com/otn-pub/otn_software/autoupgrade.jar \
        -o autoupgrade.jar
   ```

2. Transfer and replace the file in:

   ```bash
   /u00/app/oracle/autoupgrade/jar/autoupgrade.jar
   ```

To confirm the update:

```bash
java -jar jar/autoupgrade.jar -version
```

## üìù License

Apache License 2.0 ‚Äî See [LICENSE](LICENSE)

## üë§ Maintainer

Stefan Oehrli
GitHub: [github.com/oehrlis](https://github.com/oehrlis)
